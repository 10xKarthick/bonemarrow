"use strict";var bone=(()=>{var O=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var q=(n,e)=>{for(var t in e)O(n,t,{get:e[t],enumerable:!0})},M=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of k(e))!R.call(n,r)&&r!==t&&O(n,r,{get:()=>e[r],enumerable:!(o=L(e,r))||o.enumerable});return n};var j=n=>M(O({},"__esModule",{value:!0}),n);var $={};q($,{Collection:()=>E,Elements:()=>c,Model:()=>b,View:()=>x,createScope:()=>T,el:()=>F,fetchJson:()=>d});function C(n){let e=new AbortController,t=[],o=new Set,r=!1,i={signal:e.signal,onDispose(s){if(r){s();return}t.push(s)},createChild(){let s=C(i);return o.add(s),s.onDispose(()=>o.delete(s)),s},dispose(){if(!r){r=!0;for(let s of o)s.dispose();o.clear(),e.abort();for(let s of t)s();t.length=0}}};return n==null||n.onDispose(()=>i.dispose()),i}var m=null;function J(){if(m)return m;m=C(null);let n=()=>m==null?void 0:m.dispose();return window.addEventListener("pagehide",n),window.addEventListener("beforeunload",n),m}function T(){return J().createChild()}function K(n,e){var t;return`${(t=e==null?void 0:e.method)!=null?t:"GET"}:${n}`}async function d(n,e={}){var A;let{scope:t,abort:o=!1,timeout:r,retryOnFailure:i=0,retryDelay:s=0,dedupe:f=!1,init:h,parse:I}=e,g=t,p,v;if(f&&g){p=(A=g._inFlight)!=null?A:g._inFlight=new Map,v=K(n,h);let a=p==null?void 0:p.get(v);if(a)return a}let D=(async()=>{let a=0;for(;;){let P=new AbortController;o&&t&&t.signal.addEventListener("abort",()=>P.abort(),{once:!0});let w;typeof r=="number"&&(w=window.setTimeout(()=>P.abort(),r));try{let l=await fetch(n,{...h,signal:P.signal});if(!l.ok)throw new Error(`HTTP ${l.status}`);let S=await l.json();return I?I(S):S}catch(l){if(a++,l instanceof DOMException&&l.name==="AbortError"||a>i)throw l;s>0&&await new Promise(S=>setTimeout(S,w))}finally{w&&clearTimeout(w)}}})();if(p&&v&&g){p.set(v,D);let a=()=>p.delete(v);D.then(a,a),g.onDispose(a)}return D}var u=class{constructor(){this.events=new Map}on(e,t){let o=this.events.get(e);return o||(o=new Set,this.events.set(e,o)),o.add(t),()=>o.delete(t)}emit(e,...t){var o;(o=this.events.get(e))==null||o.forEach(r=>r(...t))}clear(){this.events.clear()}};function y(n,e){let{interval:t,scope:o,immediate:r=!0}=e,i=!1,s,f=async()=>{if(!i){try{await n()}catch{}i||(s=window.setTimeout(f,t))}};r?f():s=window.setTimeout(f,t);let h=()=>{i=!0,s&&clearTimeout(s)};return o.onDispose(h),h}var b=class{constructor(e){this.emitter=new u;this.data={...e}}get(e){return this.data[e]}set(e){Object.assign(this.data,e),this.emitter.emit("change",e)}onChange(e){return this.emitter.on("change",e)}async fetch(e,t){let o=await d(e,t);return this.set(o),this.data}autoRefresh(e,t){return y(()=>this.fetch(e,{...t.fetch,scope:t.scope}),t)}destroy(){this.emitter.clear()}};var E=class{constructor(){this.items=[];this.emitter=new u}async fetch(e,t){let o=await d(e,t);return this.items=o,this.emitter.emit("reset",o),o}onReset(e){return this.emitter.on("reset",e)}autoRefresh(e,t){return y(()=>this.fetch(e,{...t.fetch,scope:t.scope}),t)}destroy(){this.items.length=0,this.emitter.clear()}};var c=class n{constructor(e){this.nodes=e}each(e){return this.nodes.forEach(e),this}get(e=0){var t;return(t=this.nodes[e])!=null?t:null}find(e){let t=[];return this.each(o=>{t.push(...Array.from(o.querySelectorAll(e)))}),new n(t)}on(e,t,o){return this.each(r=>{r.addEventListener(e,t),o==null||o.onDispose(()=>r.removeEventListener(e,t))})}text(e){var t,o;return e===void 0?(o=(t=this.get())==null?void 0:t.textContent)!=null?o:"":this.each(r=>r.textContent=e)}addClass(e){return this.each(t=>t.classList.add(e))}removeClass(e){return this.each(t=>t.classList.remove(e))}};function F(n,e){return typeof n=="string"?new c(Array.from((e!=null?e:document).querySelectorAll(n))):n instanceof Element?new c([n]):n instanceof NodeList?new c(Array.from(n)):new c(n)}var x=class{constructor(e,t){this.root=e;this.model=t;this.scope=T(),this.init()}init(){}$(e){return F(e,this.root)}destroy(){var e,t;this.scope.dispose(),(t=(e=this.model)==null?void 0:e.destroy)==null||t.call(e)}};return j($);})();
