"use strict";var bone=(()=>{var M=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var B=(n,e)=>{for(var t in e)M(n,t,{get:e[t],enumerable:!0})},I=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of z(e))!q.call(n,s)&&s!==t&&M(n,s,{get:()=>e[s],enumerable:!(r=_(e,s))||r.enumerable});return n};var W=n=>I(M({},"__esModule",{value:!0}),n);var ie={};B(ie,{Collection:()=>P,Elements:()=>u,Emitter:()=>Q,Model:()=>$,TypedEmitter:()=>g,View:()=>K,createRefresh:()=>k,createRootScope:()=>D,createScope:()=>C,createView:()=>ne,el:()=>S,elFromHtml:()=>re,fetchJson:()=>v,isElements:()=>se,isScopeDisposed:()=>J});function w(n,e=!1){let t=new AbortController,r=[],s=new Set,i=!1,o=50,c={signal:t.signal,onDispose(a){if(i){try{a()}catch(l){console.error("[Scope] Error in immediate dispose callback:",l)}return}r.push(a),e&&r.length>o&&console.warn(`[Scope] Possible cleanup leak: ${r.length} cleanups registered (max: ${o})`)},createChild(){if(i){console.warn("[Scope] Attempted to create child from disposed scope");let l=w(null,e);return l.dispose(),l}let a=w(c,e);return s.add(a),a.onDispose(()=>s.delete(a)),a},dispose(){if(!i){i=!0;for(let a of s)a.dispose();s.clear(),t.abort();for(let a=r.length-1;a>=0;a--)try{r[a]()}catch(l){console.error("[Scope] Error in cleanup function:",l)}r.length=0}}};return n==null||n.onDispose(()=>c.dispose()),c}var b=null;function G(){if(b)return b;if(typeof window=="undefined")throw new Error("[Scope] createScope() requires a browser environment. Use createRootScope() instead for Node.js, workers, or SSR.");b=w(null);let n=()=>{b&&(b.dispose(),b=null)};return window.addEventListener("pagehide",n,{once:!0}),window.addEventListener("beforeunload",n,{once:!0}),b}function C(n){var t;let e=G();return w(e,(t=n==null?void 0:n.debug)!=null?t:!1)}function D(n){var e;return w(null,(e=n==null?void 0:n.debug)!=null?e:!1)}function J(n){return n.signal.aborted}var X={log:n=>console.log(n),warn:n=>console.warn(n),error:(n,e)=>console.error(n,e)},g=class{constructor(e){this.events=new Map;var t,r,s;this.debugMode=(t=e==null?void 0:e.debug)!=null?t:!1,this.logger=(r=e==null?void 0:e.logger)!=null?r:X,this.maxListeners=(s=e==null?void 0:e.maxListeners)!=null?s:50}on(e,t,r){let s=this.events.get(e);s||(s=new Set,this.events.set(e,s)),s.add(t),this.debugMode&&(this.logger.log(`[Emitter] Listener added for "${String(e)}" (total: ${s.size})`),s.size>this.maxListeners&&this.logger.warn(`[Emitter] Possible listener leak: "${String(e)}" has ${s.size} listeners (max: ${this.maxListeners})`));let i=!1,o=()=>{i||(i=!0,s.delete(t),s.size===0&&this.events.delete(e),this.debugMode&&this.logger.log(`[Emitter] Listener removed for "${String(e)}" (remaining: ${s.size})`))};return r==null||r.onDispose(o),o}once(e,t,r){let s=(...o)=>{i(),t(...o)},i=this.on(e,s,r);return i}onceAsync(e,t){return new Promise(r=>{this.once(e,(...s)=>r(s),t)})}emit(e,...t){let r=this.events.get(e);if(!r||r.size===0){this.debugMode&&this.logger.log(`[Emitter] No listeners for "${String(e)}"`);return}this.debugMode&&this.logger.log(`[Emitter] Emitting "${String(e)}" to ${r.size} listener(s)`);for(let s of[...r])try{s(...t)}catch(i){this.logger.error(`[Emitter] Error in handler for "${String(e)}":`,i)}}async emitAsync(e,...t){let r=this.events.get(e);if(!r||r.size===0){this.debugMode&&this.logger.log(`[Emitter] No listeners for "${String(e)}" (async)`);return}this.debugMode&&this.logger.log(`[Emitter] Emitting (async) "${String(e)}" to ${r.size} listener(s)`);let i=(await Promise.allSettled([...r].map(o=>o(...t)))).filter(o=>o.status==="rejected").map(o=>o.reason);if(i.length>0)throw new AggregateError(i,`[Emitter] ${i.length} handler(s) failed for "${String(e)}"`)}off(e){let t=this.events.delete(e);this.debugMode&&t&&this.logger.log(`[Emitter] All listeners removed for "${String(e)}"`)}clear(){let e=this.events.size;this.events.clear(),this.debugMode&&e>0&&this.logger.log(`[Emitter] Cleared all listeners for ${e} event(s)`)}hasListeners(e){var t,r;return((r=(t=this.events.get(e))==null?void 0:t.size)!=null?r:0)>0}listenerCount(e){var t,r;return(r=(t=this.events.get(e))==null?void 0:t.size)!=null?r:0}eventNames(){return Array.from(this.events.keys())}setDebug(e){this.debugMode=e}},Q=g;var H=new WeakMap;function Y(n,e){var s,i;let t=(i=(s=e==null?void 0:e.method)==null?void 0:s.toUpperCase())!=null?i:"GET",r=t!=="GET"&&typeof(e==null?void 0:e.body)=="string"?`:${e.body}`:"";return`${t}:${n}${r}`}async function v(n,e={}){let{scope:t,timeout:r,retryOnFailure:s=0,retryDelay:i=0,dedupe:o=!1,init:c,parse:a}=e;if(o&&t){let l=H.get(t);l||(l=new Map,H.set(t,l));let m=Y(n,c),d=l.get(m);if(d)return d;let f=V({url:n,init:c,parse:a,timeout:r,retryOnFailure:s,retryDelay:i,scope:t});l.set(m,f);let h=()=>l.delete(m);return f.then(h,h),t.onDispose(h),f}return V({url:n,init:c,parse:a,timeout:r,retryOnFailure:s,retryDelay:i,scope:t})}async function V(n){let{url:e,init:t,parse:r,timeout:s,retryOnFailure:i,retryDelay:o,scope:c}=n,a=null,l=()=>a==null?void 0:a.abort();if(c){if(c.signal.aborted)throw new DOMException("Scope already disposed","AbortError");c.signal.addEventListener("abort",l,{once:!0})}try{let m=0;for(;;){let d=new AbortController;a=d;let f;typeof s=="number"&&(f=setTimeout(()=>d.abort(),s));try{let h=await fetch(e,{...t,signal:d.signal});if(h.ok){let y=await h.json();return r?r(y):y}else throw new Error(`HTTP ${h.status}: ${h.statusText}`)}catch(h){if(ee(h)||(m++,m>i))throw h;if(o>0&&await Z(o,c==null?void 0:c.signal),c!=null&&c.signal.aborted)throw new DOMException("Scope disposed during retry","AbortError")}finally{a=null,f!==void 0&&clearTimeout(f)}}}finally{c&&c.signal.removeEventListener("abort",l)}}function Z(n,e){return new Promise(t=>{if(e!=null&&e.aborted){t();return}let r=setTimeout(t,n);e==null||e.addEventListener("abort",()=>{clearTimeout(r),t()},{once:!0})})}function ee(n){return n instanceof Error&&(n.name==="AbortError"||n.code===20)}function k(n,e){let{interval:t,scope:r,immediate:s=!0,startPaused:i=!1,onError:o,maxRetries:c=0,backoff:a=!1,onDebug:l}=e;if(!(t>0))throw new Error(`[Refresh] interval must be a positive number, got: ${t}`);let m=!1,d=i,f=!1,h=0,y,T=null,p=E=>l==null?void 0:l(`[Refresh] ${E}`),F=()=>!a||h===0?t:t*Math.min(2**h,10),x=()=>{y!==void 0&&(clearTimeout(y),y=void 0)},O=E=>{x(),y=setTimeout(L,E),p(`Next tick in ${E}ms`)},L=async()=>{if(m||d)return;if(f){p("Skipped tick: previous execution still running");return}let E=new AbortController;T=E,f=!0,p("Tick started");try{await n(E.signal),h=0,p("Tick completed")}catch(R){if(te(R)){p("Tick aborted");return}if(h++,p(`Tick failed (consecutive errors: ${h})`),o)try{o(R)}catch(U){console.error("[Refresh] Error in onError handler:",U)}else console.error("[Refresh] Unhandled error in refresh fn:",R);if(c>0&&h>=c){console.error(`[Refresh] Stopping after ${c} consecutive error(s).`),A();return}}finally{f=!1,T=null}!m&&!d&&O(F())},j=()=>{m||d||(d=!0,x(),p("Paused"))},N=()=>{m||!d||(d=!1,p("Resumed"),L())},A=()=>{m||(m=!0,d=!1,x(),T==null||T.abort(),T=null,p("Stopped"))};return r.onDispose(A),i||(s?L():O(t)),{pause:j,resume:N,stop:A,isPaused:()=>d,isExecuting:()=>f}}function te(n){return n instanceof Error&&(n.name==="AbortError"||n.code===20)}var $=class{constructor(e,t){this.emitter=new g;this.initial={...e},this.data={...e},this.scope=t!=null?t:D(),this.scope.onDispose(()=>this._destroy())}get(e){return this.checkDestroyed(),this.data[e]}getAll(){return this.checkDestroyed(),{...this.data}}isDirty(){return this.checkDestroyed(),Object.keys(this.initial).some(e=>this.initial[e]!==this.data[e])}has(e,t){return this.checkDestroyed(),this.data[e]===t}set(e){this.checkDestroyed();let t={},r=!1;for(let s of Object.keys(e))e[s]!==this.data[s]&&(t[s]=e[s],r=!0);return r?(Object.assign(this.data,t),this.emitter.emit("change",t),!0):!1}reset(){this.checkDestroyed();let e={...this.initial};Object.keys(e).some(r=>e[r]!==this.data[r])&&(this.data=e,this.emitter.emit("change",e))}onChange(e,t){return this.checkDestroyed(),this.emitter.on("change",e,t)}watch(e,t,r){return this.checkDestroyed(),this.emitter.on("change",s=>{e in s&&t(s[e])},r)}async fetch(e,t){this.checkDestroyed();let r=await v(e,{scope:this.scope,timeout:t});return this.set(r),this.getAll()}autoRefresh(e,t){var s;this.checkDestroyed();let r=(s=t.scope)!=null?s:this.scope;return k(async i=>{if(this.isDestroyed())return;let o=await v(e,{scope:r});this.set(o)},{interval:t.interval,scope:r,immediate:t.immediate,startPaused:t.startPaused,onError:t.onError,maxRetries:t.maxRetries,backoff:t.backoff,onDebug:t.onDebug})}destroy(){this.scope.dispose()}isDestroyed(){return this.scope.signal.aborted}_destroy(){this.emitter.clear()}checkDestroyed(){if(this.isDestroyed())throw new Error("[Model] Cannot use a destroyed model")}};var P=class{constructor(e=[],t){this.items=[];this.emitter=new g;this.items=[...e],this.scope=t!=null?t:D(),this.scope.onDispose(()=>this._destroy())}getAll(){return this.checkDestroyed(),[...this.items]}get length(){return this.checkDestroyed(),this.items.length}at(e){return this.checkDestroyed(),this.items[e]}find(e){return this.checkDestroyed(),this.items.find(e)}findIndex(e){return this.checkDestroyed(),this.items.findIndex(e)}filter(e){return this.checkDestroyed(),this.items.filter(e)}map(e){return this.checkDestroyed(),this.items.map(e)}forEach(e){this.checkDestroyed(),this.items.forEach(e)}some(e){return this.checkDestroyed(),this.items.some(e)}every(e){return this.checkDestroyed(),this.items.every(e)}add(...e){this.checkDestroyed(),this.items.push(...e),this.emitter.emit("add",e)}remove(e){this.checkDestroyed();let t=[];for(let r=this.items.length-1;r>=0;r--)e(this.items[r],r)&&(t.unshift(this.items[r]),this.items.splice(r,1));return t.length>0&&this.emitter.emit("remove",t),t}removeAt(e){if(this.checkDestroyed(),e<0||e>=this.items.length)return;let[t]=this.items.splice(e,1);return this.emitter.emit("remove",[t]),t}update(e,t){this.checkDestroyed();let r=[];for(let s=0;s<this.items.length;s++)if(e(this.items[s],s)){let i={...this.items[s],...t};Object.keys(t).some(c=>t[c]!==this.items[s][c])&&(this.items[s]=i,r.push(i))}return r.length>0&&this.emitter.emit("update",r),r}move(e,t){if(this.checkDestroyed(),e===t||e<0||e>=this.items.length||t<0||t>=this.items.length)return;let[r]=this.items.splice(e,1);this.items.splice(t,0,r),this.emitter.emit("sort")}sort(e){this.checkDestroyed(),this.items.sort(e),this.emitter.emit("sort")}reset(e){this.checkDestroyed(),this.items=[...e],this.emitter.emit("reset",[...this.items])}clear(){this.checkDestroyed(),this.items.length>0&&(this.items=[],this.emitter.emit("reset",[]))}async fetch(e,t){this.checkDestroyed();let r=await v(e,{scope:this.scope,timeout:t});return this.reset(r),this.getAll()}autoRefresh(e,t){var s;this.checkDestroyed();let r=(s=t.scope)!=null?s:this.scope;return k(async()=>{if(this.isDestroyed())return;let i=await v(e,{scope:r});this.reset(i)},{interval:t.interval,scope:r,immediate:t.immediate,startPaused:t.startPaused,onError:t.onError,maxRetries:t.maxRetries,backoff:t.backoff,onDebug:t.onDebug})}onAdd(e,t){return this.checkDestroyed(),this.emitter.on("add",e,t)}onRemove(e,t){return this.checkDestroyed(),this.emitter.on("remove",e,t)}onUpdate(e,t){return this.checkDestroyed(),this.emitter.on("update",e,t)}onReset(e,t){return this.checkDestroyed(),this.emitter.on("reset",e,t)}onSort(e,t){return this.checkDestroyed(),this.emitter.on("sort",e,t)}onChange(e,t){this.checkDestroyed();let r=this.onAdd(()=>e(),t),s=this.onRemove(()=>e(),t),i=this.onUpdate(()=>e(),t),o=this.onReset(()=>e(),t);return()=>{r(),s(),i(),o()}}destroy(){this.scope.dispose()}isDestroyed(){return this.scope.signal.aborted}_destroy(){this.items=[],this.emitter.clear()}checkDestroyed(){if(this.isDestroyed())throw new Error("[Collection] Cannot use a destroyed collection")}};var u=class n{constructor(e){this._nodes=e}get length(){return this._nodes.length}toArray(){return[...this._nodes]}each(e){return this._nodes.forEach(e),this}get(e=0){var t;return(t=this._nodes[e])!=null?t:null}first(){var e;return(e=this._nodes[0])!=null?e:null}last(){var e;return(e=this._nodes[this._nodes.length-1])!=null?e:null}find(e){let t=[];return this.each(r=>{t.push(...Array.from(r.querySelectorAll(e)))}),new n(t)}filter(e){return typeof e=="string"?new n(this._nodes.filter(t=>t.matches(e))):new n(this._nodes.filter(e))}not(e){return new n(this._nodes.filter(t=>!t.matches(e)))}parent(){let e=[];return this.each(t=>{t.parentElement&&e.push(t.parentElement)}),new n(e)}siblings(){let e=[];return this.each(t=>{t.parentElement&&Array.from(t.parentElement.children).forEach(r=>{r!==t&&!e.includes(r)&&e.push(r)})}),new n(e)}closest(e){let t=[];return this.each(r=>{let s=r.closest(e);s&&t.push(s)}),new n(t)}children(){let e=[];return this.each(t=>{e.push(...Array.from(t.children))}),new n(e)}text(e){var t,r;return e===void 0?(r=(t=this.get())==null?void 0:t.textContent)!=null?r:"":this.each(s=>{s.textContent=e})}html(e){var t,r;return e===void 0?(r=(t=this.get())==null?void 0:t.innerHTML)!=null?r:"":this.each(s=>{s.innerHTML=e})}attr(e,t){var r,s;return t===void 0?(s=(r=this.get())==null?void 0:r.getAttribute(e))!=null?s:null:this.each(i=>{i.setAttribute(e,t)})}removeAttr(e){return this.each(t=>{t.removeAttribute(e)})}data(e,t){var r;if(t===void 0){let s=this.get();return s instanceof HTMLElement&&(r=s.dataset[e])!=null?r:null}return this.each(s=>{s instanceof HTMLElement&&(s.dataset[e]=t)})}val(e){if(e===void 0){let t=this.get();return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?t.value:""}return this.each(t=>{(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(t.value=e)})}on(e,t,r){return this.each(s=>{s.addEventListener(e,t),r==null||r.onDispose(()=>{s.removeEventListener(e,t)})})}once(e,t){return this.each(r=>{r.addEventListener(e,t,{once:!0})})}off(e,t){return this.each(r=>{r.removeEventListener(e,t)})}trigger(e,t,r){let{bubbles:s=!0,cancelable:i=!0}=r!=null?r:{};return this.each(o=>{o.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:s,cancelable:i}))})}addClass(e){let t=e.split(" ").filter(Boolean);return this.each(r=>{r.classList.add(...t)})}removeClass(e){let t=e.split(" ").filter(Boolean);return this.each(r=>{r.classList.remove(...t)})}toggleClass(e,t){let r=e.split(" ").filter(Boolean);return this.each(s=>{r.forEach(i=>{s.classList.toggle(i,t)})})}hasClass(e){return this._nodes.some(t=>t.classList.contains(e))}css(e,t){if(typeof e=="string"&&t===void 0){let r=this.get();return r instanceof HTMLElement?getComputedStyle(r).getPropertyValue(e):""}return typeof e=="string"?this.each(r=>{r instanceof HTMLElement&&r.style.setProperty(e,t)}):this.each(r=>{r instanceof HTMLElement&&Object.entries(e).forEach(([s,i])=>{r.style.setProperty(s,i)})})}show(){return this.each(e=>{e instanceof HTMLElement&&(e.style.display="")})}hide(){return this.each(e=>{e instanceof HTMLElement&&(e.style.display="none")})}toggle(e){return this.each(t=>{if(t instanceof HTMLElement){let r=e!=null?e:t.style.display==="none";t.style.display=r?"":"none"}})}isVisible(){return this._nodes.some(e=>e instanceof HTMLElement?e.style.display!=="none"&&e.offsetParent!==null:!1)}append(e){return this.each(t=>{typeof e=="string"?t.insertAdjacentHTML("beforeend",e):e instanceof n?e.each(r=>t.appendChild(r.cloneNode(!0))):t.appendChild(this._nodes.length>1?e.cloneNode(!0):e)})}prepend(e){return this.each(t=>{if(typeof e=="string")t.insertAdjacentHTML("afterbegin",e);else if(e instanceof n){let r=t.firstChild;e.each(s=>{t.insertBefore(s.cloneNode(!0),r)})}else t.insertBefore(this._nodes.length>1?e.cloneNode(!0):e,t.firstChild)})}remove(){return this.each(e=>{e.remove()})}empty(){return this.each(e=>{e.innerHTML=""})}clone(e=!0){return new n(this._nodes.map(t=>t.cloneNode(e)))}focus(){let e=this.get();return e instanceof HTMLElement&&e.focus(),this}blur(){let e=this.get();return e instanceof HTMLElement&&e.blur(),this}};function S(n,e){var r,s;if(typeof document=="undefined")throw new Error("[el] DOM is not available in this environment. el() requires a browser context.");if(n instanceof u)return n;if(typeof n=="string"){let i=n.trim();if(!i)return new u([]);try{return new u(Array.from((e!=null?e:document).querySelectorAll(i)))}catch(o){return console.error(`[el] Invalid selector: "${i}"`,o),new u([])}}if(n instanceof Element)return new u([n]);if(n instanceof NodeList){let i=[];return n.forEach(o=>{o instanceof Element&&i.push(o)}),new u(i)}if(n instanceof HTMLCollection)return new u(Array.from(n));if(Array.isArray(n)){let i=n.filter(o=>o instanceof Element);return i.length!==n.length&&console.warn(`[el] ${n.length-i.length} item(s) in array were not Elements and were filtered out`),new u(i)}let t=n!=null&&typeof n=="object"?(s=(r=n.constructor)==null?void 0:r.name)!=null?s:"unknown object":typeof n;return console.warn(`[el] Unrecognized input type: ${t}`),new u([])}function re(n){if(typeof document=="undefined")throw new Error("[elFromHtml] DOM is not available in this environment. elFromHtml() requires a browser context.");let e=document.createElement("template");return e.innerHTML=n.trim(),new u(Array.from(e.content.children))}function se(n){return n instanceof u}var K=class{constructor(e,t,r={}){this.root=e;this.model=t;this._children=new Set;let{autoDestroy:s=!0,parentScope:i}=r;this.scope=i?i.createChild():C(),this.scope.onDispose(()=>{this._children.clear()}),s&&this._setupAutoDestroy(),this.init()}init(){}render(){}$(e){return S(e,this.root)}$root(){return S(this.root)}focus(){let e=this.root;return e instanceof HTMLElement&&e.focus(),this}on(e,t){this.checkDestroyed(),this.$root().on(e,t,this.scope)}onDocument(e,t){this.checkDestroyed(),document.addEventListener(e,t),this.scope.onDispose(()=>document.removeEventListener(e,t))}onWindow(e,t){this.checkDestroyed(),window.addEventListener(e,t),this.scope.onDispose(()=>window.removeEventListener(e,t))}emit(e,t){this.checkDestroyed(),this.$root().trigger(e,t)}createChild(e,t,r){this.checkDestroyed();let s=new e(t,r,{parentScope:this.scope,autoDestroy:!1});return this._children.add(s),s.scope.onDispose(()=>this._children.delete(s)),s}createChildren(e,t,r){this.checkDestroyed();let s=[];return this.$(t).each((i,o)=>{let c=r?r(i,o):void 0;s.push(this.createChild(e,i,c))}),s}show(){return this.checkDestroyed(),this.$root().show(),this}hide(){return this.checkDestroyed(),this.$root().hide(),this}toggle(e){return this.checkDestroyed(),this.$root().toggle(e),this}isVisible(){return this.$root().isVisible()}destroy(){this.scope.dispose()}isDestroyed(){return this.scope.signal.aborted}getRoot(){return this.root}getModel(){return this.model}_setupAutoDestroy(){if(!this.root.parentElement){console.warn("[View] autoDestroy is enabled but root has no parentElement. The MutationObserver cannot attach. Ensure root is in the DOM before constructing the view, or disable autoDestroy.");return}let e=new MutationObserver(t=>{for(let r of t)for(let s of Array.from(r.removedNodes))if(s===this.root||s instanceof Element&&s.contains(this.root)){this.destroy(),e.disconnect();return}});e.observe(this.root.parentElement,{childList:!0,subtree:!0}),this.scope.onDispose(()=>e.disconnect())}checkDestroyed(){if(this.isDestroyed())throw new Error("[View] Cannot use a destroyed view")}};function ne(n,e,t,r){if(typeof document=="undefined")throw new Error("[createView] DOM is not available in this environment. createView() requires a browser context.");let s=typeof e=="string"?document.querySelector(e):e;if(!s)throw new Error(`[createView] Element not found: ${e}`);return new n(s,t,r)}return W(ie);})();
